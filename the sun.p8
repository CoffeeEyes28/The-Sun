pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--[[

sun platformer 
- control piece of sun

- sun can move and jump 
		in order to platform home
		
- avoid bomb boxes and other hazards 

]]--

--var

function _init()

--player
		plyr={
		sp=1,
		x=10,
		y=10,
		w=8,
		h=8,
		flp=false,
		dx=0,
		dy=0,
		max_dx=2,
		max_dy=3,
		acc=0.42,
		boost=4,
 	anim=0,
 	wait=.80,
		moving=false,
		jumping=false,
		falling=false,
		slidding=false,
		landed=false	
	}
	
	gravity=0.2
	friction=0.83
	
	--simple cam
	cam_x=0
	
	-- map limits 
	map_start=0
	map_end=1024
	
end






-->8
--update and draw

function _update()

	plyr_update()

	plyr_anim()
	
	-- simple cam
	cam_x=plyr.x-64+plyr.w/2
	
	if cam_x<map_start then
				cam_x=map_start
	end
	
	if cam_x>map_end-128 then
				cam_x=map_end-128
	end
	camera(cam_x,0)
	
end

function _draw()
printh(plyr.sp)
	cls()
	map(0,0)
		spr(
					plyr.sp,
					plyr.x,
					plyr.y,
					plyr.w/8,
					plyr.h/8,
					plyr.flp
						)
	time()
end


-->8
--collision 

function map_collide(obj,aim,flag)
--obj = table x,y,w,h
--aim= left,right,up,down
	
	local x=obj.x local y=obj.y
	local w=obj.w local h=obj.h
	
	local x1=0 local y1=0
	local	x2=0	local y2=0
	
	if aim=="left" then
				x1=x-1 y1=y
				x2=x			y2=y+h-2
				
	elseif aim=="right" then
				x1=x+w		 y1=y
				x2=x+w+1 y2=y+h-1
	
	elseif aim=="up" then
				x1=x+1	 	 y1=y-1
				x2=x+w-1  y2=y
				
	elseif aim=="down" then
			
				x1=x	  	y1=y+h
				x2=x+w  y2=y+h			
	end
	
	--pixels to tiles 
		x1/=8			y1/=8
		x2/=8		 y2/=8
		
		if fget(mget(x1,y1), flag)
		or fget(mget(x1,y2), flag)
		or fget(mget(x2,y1), flag)
		or fget(mget(x2,y2), flag) then
			return true
	else
		return false
		end
		
end
-->8
--plyr
function plyr_update()
	--physics
	plyr.dy+=gravity
	plyr.dx*=friction

	--controls
		if btn(⬅️) then
			plyr.dx-=plyr.acc
			plyr.moving=true
			plyr.flp=true
			--sfx(03)
		end
		
		
		if btn(➡️) then
			plyr.dx+=plyr.acc
			plyr.moving=true
			plyr.flp=false
		--	sfx(03)
		end
		
		--slide
		if plyr.moving
		and not btn(⬅️)
		and not btn(➡️)
		and not plyr.falling
		and not plyr.jumping then
						plyr.moving=false
						plyr.sliding=true
						sfx(02)
		end
	
		
		--jump
		if btnp(❎)	and 
				plyr.landed then
			 plyr.dy-=plyr.boost
			 plyr.landed=false
			 sfx(0) 
		end	
			
			--up and down
		
			if plyr.dy>0 then
				plyr.falling=true
				plyr.landed=false
				plyr.jumping=false
			end
			
			if plyr.dy>0 and
					 map_collide(plyr,"down",0) then
						plyr.landed=true
						plyr.falling=false
						plyr.dy=0			
						plyr.y-=(plyr.y+plyr.h)%8
						
						 		
	elseif plyr.dy<0 then
					plyr.jumping=true
					if map_collide(plyr,"up",0) then
					plyr.dy=0
			
			end
	end		

	-- left and right
	if plyr.dx<0 then
		
		if map_collide(plyr,"left",1) then
					plyr.dx=0
	end
		
 elseif plyr.dx>0 then
 	if map_collide(plyr,"right",1) then
 				plyr.dx=0
 	end
	end
	
	
	--stop slide
	if plyr.sliding then
	if abs(plyr.dx)<.2
	or plyr.moving then
				plyr.dx=0
				plyr.sliding=false
	end
end
 
 plyr.x+=plyr.dx
 plyr.y+=plyr.dy
 
 	-- plyr limits
			
	if plyr.x<map_start then
				plyr.x=map_start
	end
				
	if plyr.x>map_end-plyr.w then
						plyr.x=map_end-plyr.w
	end
					--animation 
				
	function plyr_anim()
		if plyr.jumping then
					plyr.sp=7
		elseif plyr.falling then
					plyr.sp=1
		elseif plyr.sliding then
									plyr.sp=18
		elseif plyr.moving then
									plyr.sp=9
		elseif plyr.jumping and plyr.moving then
									plyr.sp=5
			
				
		else
			 if time()-plyr.anim>plyr.wait then
						plyr.anim=time()
						plyr.sp+=1
					if plyr.sp>2 then
							plyr.sp=1
					end
		 	end
	 end
end -- animate end


end	-- plyr update end 
	
	
	
	
	
	
	
	
	
	
	

__gfx__
00000000aaaaaaaaaaaaaaaaaaaaaaaa00000000aaaaaac700000000ac7aac7aaaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000
00000000ac7aac7aaaaaaaaaa77aa77a00000000aaaaaacc00000000accaaccaac7aac7aaaaaac70000000000000000000000000000000000000000000000000
00000000accaaccaac7aac7aaccaacca00000000aaaaaacc00000000accaaccaaccaaccaaaaaacc0000000000000000000000000000000000000000000000000
00000000accaaccaaccaaccaaccaacca00000000aaaaaaaa00000000aaaaaaaaaccaaccaaaaaacc0000000000000000000000000000000000000000000000000
00000000aaaaaaaaaccaaccaaaaaaaaa00000000aaaaaaaa00000000aaaaaaaaaaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaaaaaaa99aaa00000000aaaaaaaa00000000aaaaaaaaaaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaaaaaa9999aa00000000aaaaaaaa00000000aaaaaaaaaaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaaaaaa9999aa00000000000000000000000000000000aaaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaa0000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaac7aaaac70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaccaaaacc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaccaaaacc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa00aaa6155550634453444707070706666666656666665ccc00cccc5c00c5cccc0043b44454434344544434443444344544334555555550000000000000000
aaa00aaa1155550044353344070707076666666664f66666ccc00cccc5c00c5c33b0033343454343434543343443443434543443555555550000000000000000
aaa00aaa55555555555555557070707066666666a6600666ccc00cccc5c00c5c43300c5c34353444443534434334334443534334555555550000000000000000
00000000555555554544435307070707666666666600706600000000000000000000000055555555555555555555555555555555555555550000000000000000
00000000555555553544435470707070666666666000000600000000000000000000000043443435344443343443534434443444555555550000000000000000
aaa00aaa5555555555555555070707076666666660000006ccc00cccc5c00c5cc5c00c5c44334345434434434334543343434434555555550000000000000000
aaa00aaa0055551144543454707070706666666666000066ccc00cccc5c00c5cc5c00c5c43434435443343344344534434344443555555550000000000000000
aaa00aaa6055551643544453070707076666666656600665ccc00cccc5c00c5cc5c00c5c55555555555555555555555555555555555555550000000000000000
00000000000000000000000000000000000000006600006600000000000000000000000044453444444454444444444454444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044454334344454444444444454444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044454433444454444444444454444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044454444344454444444444454444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000055555555555555555555555555555555000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444454444444444444445444444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444454444444444444445444444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444454444444444444445444444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444454444444444444445444444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000055555555555555555555555555555555000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444444544444444444444454444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444444544444444444444454444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444444544444444444444454444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000055555555555555555555555555555555000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044445444444444444444444544444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044445444444444444444444544444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044445444444444444444444544444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044445444444444444444444544444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000055555555555555555555555555555555000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444454444444444544444445444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444454444444444544444445444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444454444444444544444445444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000044444444454444444444544444445444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000055555555555555555555555555555555000000000000000000000000
__gff__
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030b010700000003030303010100000000000000000000030303030000000000000000000000000303030300000000000000000000000003030303000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4c46464a4b4c494a4b4c494a4b4c494a4b4c4646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
5946464646464646464646404040404046464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
6946464646464646464646404040404046464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
7946464646464646464646404040404046464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
4946464646464646464646464040404046464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
5946464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
6946464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
7946464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646464646
4946464848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848
595a484747474747474747474747474747474748484747474848474747484747474848474747484847474748484747474847474748484747474848474747484847474748484747474847474748474747474747484847474748484747474848474747484847474748484747474848474747484847474748484747474848474747
696a6b4848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848
797a7b7c48484748474c4c4845484c4c48484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848484848
494a4b4c494a4b4c494a4b4c494a494a4b4c494a4b4c494a4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b4c4b4c494a4b4c4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b4c4b4c494a4b4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b4c4b4c494a4b4c494a4b
595a5b5c595a5b5c595a5b5c595a595a5b5c595a5b5c595a5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b5c5b5c595a5b5c5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b5c5b5c595a5b5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b5c5b5c595a5b5c595a5b
696a6b6c696a6b6c696a6b6c696a696a6b6c696a6b6c696a6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b6c6b6c696a6b6c6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b6c6b6c696a6b6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b6c6b6c696a6b6c696a6b
797a7b7c797a7b7c797a7b7c797a797a7b7c797a7b7c797a7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b7c7b7c797a7b7c7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b7c7b7c797a7b7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b7c7b7c797a7b7c797a7b
4941414141414141414141414141414141414141414141414141414141410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000050020500405006050080500a0500c0500e050100501205014050150501505015050140501405014050130501305011050100500e0500c0500c0500b0500a050090500705006050050500405003050
00010000006700067001670016700167001670016700167001670006700067000670026700467005670036700467005670036700267003670096000b6000c6000d6000f600116000660000600016000060000600
00010000005000455006550085500a5500055007500095000c5000d5000d5000c5000b500095000950008500075000750007500075000750011500085000850008500085000d5000c50000500005000050000500
000100000175003750017400075002700027000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
